<template name="cartPage">
	<h1 class="page-header">
		{{_ "cart"}}
		{{#if lastShoppingContext}}
	  		<a href="#" alt="Return where you were" class="back-btn" style="float:left;">
	  		<i  class="material-icons">undo</i>
	  		</a>
  		{{/if}}
	</h1>
	
	{{#if currentUser.pendingPurchases}}
		<p class="pending-purchases-message">
			{{{_ "pendingPurchasesMessage" count=(currentUser.pendingPurchases) url='/settings/purchases'}}}
		</p>
		<hr />
	{{/if}}

	{{#unless empty}}
		<div class="cart-items-list">
		{{#each purchases}}
			{{> cartItem }}
		{{/each}}
		</div>
		{{#if showDeliveryForm}}
			{{> deliveryInformationForm }}
		{{else}}
		<center><button class="btn btn-warning btn-lg btn-block btn-raised submit-cart-btn">
			{{_ "submitCart"}}</button></center>
		{{/if}}
		<div style="margin-top:20px;" ></div>
	{{/unless}}

	{{#if empty }}
		{{#unless currentUser.pendingPurchases}}
			<div class="no-cart-items-message">{{_ "noItemsMessage"}}</div>
		{{/unless}}
	{{/if}}
</template>

<template name="cartItem">
	<div class="row cart-item">		
		{{> itemThumbnail item}}			
		{{> cartItemForm this}}
	</div>
	<hr />
</template>

<template name="cartItemForm">
	<div class="col-xs-6">
	{{#autoForm 
		collection=formCollection 
		id=cartItemFormId
		type="method-update"
		doc=this
		autosave=true
		resetOnSuccess=false
		meteormethod="cart.updatePurchase"}}
		{{> afQuickField name='notes' label=false rows=5 placeholder=notesPlaceholder}}
		<div class="form-group" style="margin-bottom:0px;">
			<div class="input-group">    
				{{> afQuickField name='quantity' style="width:100%;" type="tel"}}
				<span class="input-group-btn input-group-sm">
					<button 
						class="btn btn-danger btn-fab btn-fab-mini remove-cart-item-btn" 
						style="float:left; top:25px;">
						<i class="material-icons">clear</i></button>
				</span>
			</div>
		</div>
	{{/autoForm}}
	</div>
</template>

<template name="deliveryInformationForm">

	<p>{{_ "insertDeliveryInfoPlease"}}:</p>
	{{#autoForm 
		schema=formCollection 
		id="deliveryInformationForm" 
		type="method"
		doc=defaultValues
		meteormethod="cart.submit"}}

		{{> afQuickField name='email'}}
		{{> afQuickField name='phone' type="tel"}}
		{{> afQuickField name='deliveryAddress'}}
		{{> afQuickField name='deliveryDate' value=(nextWeek)}}

		<center><button class="btn btn-warning btn-block btn-raised submit-cart-final-btn">
			{{_ "submitCart"}}</button></center>

	{{/autoForm}}


</template>



